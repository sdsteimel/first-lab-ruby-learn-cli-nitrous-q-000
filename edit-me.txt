It took a while, but I think I've got it!